# YouTube Downloader

YouTubeから動画・音声をダウンロードできる、詳細な設定が可能なGUIアプリケーションです。

**🔒 設定ファイルとダウンロード履歴は暗号化され、直接編集できないように保護されています。**

## 機能

- **動画・音声ダウンロード**
  - 動画: 4K/1080p/720p/480p/360p
  - 音声: 最高/高/中/低
  - フォーマット: mp4/webm/mkv (動画), mp3/m4a/opus (音声)

- **プレイリスト対応**
  - プレイリスト全体または範囲指定でダウンロード可能

- **字幕ダウンロード**
  - 通常字幕と自動生成字幕に対応
  - 複数言語対応（日本語・英語など）

- **サムネイル**
  - サムネイルのダウンロード
  - ファイルへの埋め込み

- **カスタマイズ**
  - ファイル名テンプレートのカスタマイズ
  - 保存先フォルダの選択

- **履歴管理**
  - ダウンロード履歴の表示
  - 設定の保存・読み込み

- **🔒 セキュリティ機能**
  - 設定ファイルの暗号化（Fernet対称暗号化）
  - ダウンロード履歴の暗号化
  - マシン固有の暗号化キー（PBKDF2HMAC）
  - 直接編集不可の設定ファイル
  - `data`サブディレクトリに安全に保存

## セキュリティについて

設定ファイルとダウンロード履歴は暗号化されて保存されます：

- **暗号化方式**: Fernet対称暗号化
- **キー生成**: PBKDF2HMAC（100,000イテレーション）
- **保存場所**: `data`サブディレクトリ
  - `data/config.dat`: 暗号化された設定ファイル
  - `data/.key`: 暗号化キー（隠しファイル）
- **マシン固有**: キーはマシン固有の情報から生成されるため、他のマシンでは復号化できません

これにより、設定ファイルを直接編集したり、ダウンロード履歴を改ざんすることができません。

## インストール

### 1. 依存関係のインストール

```bash
cd d:\root\Antigravoty.Project\youtubedownloader
pip install -r requirements.txt
```

### 2. FFmpegのインストール（必須）

yt-dlpは動画・音声の処理にFFmpegが必要です。

**Windowsの場合:**
1. [FFmpeg公式サイト](https://ffmpeg.org/download.html)からダウンロード
2. 解凍してPATHに追加

または、chocolateyを使用:
```bash
choco install ffmpeg
```

## 使用方法

### Pythonスクリプトとして実行

```bash
python main.py
```

### 基本的な使い方

1. **URLを入力**: YouTubeの動画またはプレイリストのURLを入力
2. **設定を選択**: 
   - ダウンロードタイプ（動画/音声）
   - 品質とフォーマット
   - 保存先フォルダ
   - 詳細オプション（字幕、サムネイルなど）
3. **ダウンロード**: 「ダウンロード」ボタンをクリック
4. **進捗確認**: 進捗バーとログで状態を確認

### 詳細オプション

- **字幕をダウンロード**: 利用可能な字幕をダウンロード
- **自動生成字幕を含む**: 自動生成された字幕も含める
- **サムネイルをダウンロード**: サムネイル画像を別ファイルとして保存
- **サムネイルを埋め込む**: 動画/音声ファイルにサムネイルを埋め込む
- **プレイリストモード**: プレイリスト全体をダウンロード
  - 範囲指定可能（例: 1〜10で最初の10件のみ）

### ファイル名テンプレート

デフォルト: `%(title)s.%(ext)s`

利用可能な変数:
- `%(title)s`: 動画タイトル
- `%(id)s`: 動画ID
- `%(ext)s`: 拡張子
- `%(uploader)s`: 投稿者名
- `%(upload_date)s`: アップロード日
- `%(playlist)s`: プレイリスト名
- `%(playlist_index)s`: プレイリスト内のインデックス

例:
- `%(title)s - %(uploader)s.%(ext)s`
- `%(upload_date)s - %(title)s.%(ext)s`
- `[%(id)s] %(title)s.%(ext)s`

## .exe化（後で実施する場合）

PyInstallerを使用してスタンドアロンの.exeファイルを作成できます。

### 1. PyInstallerのインストール

```bash
pip install pyinstaller
```

### 2. ビルド

```bash
build.bat
```

または手動で:

```bash
pyinstaller --onefile --windowed --name "YouTubeDownloader" --icon=icon.ico main.py
```

生成された.exeファイルは`dist`フォルダに作成されます。

## トラブルシューティング

### FFmpegが見つからない

エラー: `ERROR: ffmpeg not found`

**解決方法**: FFmpegをインストールしてPATHに追加してください。

### ダウンロードが失敗する

- インターネット接続を確認
- URLが正しいか確認
- yt-dlpを最新版に更新: `pip install --upgrade yt-dlp`

### 字幕がダウンロードできない

一部の動画には字幕が利用できない場合があります。「自動生成字幕を含む」オプションを有効にしてください。

### 設定をリセットしたい

設定ファイルは暗号化されているため、直接編集できません。設定をリセットするには：

1. アプリケーションを終了
2. `data`ディレクトリを削除
3. アプリケーションを再起動（デフォルト設定で起動）

### 暗号化キーを紛失した

`data/.key`ファイルを削除すると、既存の設定が読み込めなくなります。この場合：

1. `data`ディレクトリ全体を削除
2. アプリケーションを再起動（新しいキーと設定が生成されます）

## ファイル構成

```
youtubedownloader/
├── main.py              # メインGUIアプリケーション
├── downloader.py        # ダウンロード処理
├── config.py            # 設定管理（暗号化対応）
├── requirements.txt     # 依存関係
├── README.md            # 使用方法
├── build.bat            # .exe化スクリプト
├── data/                # データディレクトリ（自動生成）
│   ├── config.dat       # 暗号化された設定ファイル
│   └── .key             # 暗号化キー（隠しファイル）
└── __pycache__/         # Pythonキャッシュ
```

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 注意事項

- YouTubeの利用規約を遵守してください
- 著作権で保護されたコンテンツのダウンロードには注意が必要です
- 個人的な使用の範囲内で利用してください
